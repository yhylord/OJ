276 - Codeforces Round #169 (Div. 2)

E. Little Girl and Problem on Trees

【题目大意】

给出一棵N(2 <= N <= 10^5)个初始权值为0的结点的树，其中除了根结点1外，每个结点的度都不超过2。现在有2种共Q(1 <= N <= 10^5)个操作：把距离v_i不超过d_i的所有结点的权值都加上x_i；输出结点v_i的权值。

【算法分析】

考虑“每个结点的度都不超过2”这个特殊性质，我们会发现，这棵树就是由根结点导出的若干条链。因此，我们先把所有的链拉出来，重新组合到一起，记录每个结点的新位置、所在的链的序号、在链中的位置（即原树中的高度），对于每一条链记录它的大小。

这样，问题处理起来就方便多了。因为是修改区间查询点，我们考虑使用树状数组来维护每一条链。考虑修改操作，我们首先把本链中受影响的部分加一个值，这是很容易实现的。考虑通过根延伸出去的部分，设长度为L，必然会对所有链的前L个结点造成影响，因此我们只要再建一个整体的树状数组，维护所有的链都进行的修改，那么，在加入延伸L的修改后注意撤销掉本链的前L个的修改。

为方便起见，建议把根节点单独拿出来处理。注意实现的一些细节，整体时间复杂度O(N + QlogN)。
