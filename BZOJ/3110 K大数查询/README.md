BZOJ 3110 K大数查询

考虑使用可持久化线段树来解决这个问题，A_i表示位置i上的权值线段树，对于A_a, A_a + 1, ..., A_b，操作1即都插入c，操作2即查询其中第K大值。

对于查询区间的操作，我们知道，令S_i = A_1 + A_2 + ... + A_i，那么查询区间[a, b]即在权值线段树上S_b - S_(a - 1)上查询第K大值。

由于是修改区间，我们考虑作差来完成区间修改转化为单点修改，令D_i = A_i - A_(i - 1)，那么S_i = D_1 * i + (D_2 - D_1) * (i - 1) + (D_3 - D_2) * (i - 2) + ... + D_i，即S_i = sum{D_k * (i - k + 1)}(1 <= k <= i)。

对于某个确定的i，我们只要知道sum{D_k}(1 <= k <= i}和sum{D_k * k}(1 <= k <= i}，那么很容易想到用树状数组来维护这两个和，而且修改只需要对两个端点进行。

时间复杂度O(Nlog^2N)。
