BZOJ 2165 大楼

用f(i, j, p)表示从房间i到房间j乘坐p次电梯能够上升的最大层数，则有f(i, j, p) = max{f(i, k, p - 1) * f(k, j, p - 1)}(1 <= k <= N)。

易证该运算满足结合律，故可以将矩阵乘法使用该法则进行运算。

初始矩阵为f^1，我们可以倍增求出f^2, f^4, ...，直到第一行存在大于等于M的数，注意运算过程中为防止溢出需将大于M的数设为M。

问题转化为求f^p第一行均小于M的最大的p，那么我们可以用二进制拆分的思想从大到小累加使得当前矩阵第一行均小于M的f^(2^c)。

显然最后答案为sigma{2^c} + 1。时间复杂度O(N^3logM)。
