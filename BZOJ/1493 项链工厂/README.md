BZOJ 1493 项链工厂

题目的第一个瓶颈是环，然而我们发现，不管是旋转还是翻折，这个环的形态都是没有改变的。因此，我们只需要维护位置1对应的是哪个珠子，同时维护在环上的点数方向是顺时针还是逆时针，就可以根据给出的位置换算出对应的珠子。

那么，前两个操作也都很好完成，同时，我们成功地破环为链，将它转化为了一个区间上的维护问题，通常使用线段树来进行维护，其中区间覆盖、单点修改、区间查询等都是线段树的基本操作，结合基本的打标记技巧即可。

要维护的信息相对而言比较显然，只要维护区间的左端点的颜色、右端点的颜色和区间的部分个数，就可以很方便地完成信息的合并。

需要注意的是，我在处理两段相连时假如首尾相同则在两段原始部分个数直接相加的基础上减1，但如果两段的长度和就为1必须输出1。

时间复杂度O((N + Q)logN)。
