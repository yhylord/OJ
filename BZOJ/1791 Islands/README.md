BZOJ 1791 Islands

由于每个点都对应一条边，任意一个N个点的连通块都有N条边，故每个连通块都是环套树。

显然最后只要把每个连通块里的最优解加起来就可以了，因此我们考虑一个连通块的处理。

一个连通块的最优解，要么在环上某个点所套的那棵树内部，要么是环上两个点引出的树内部最长路加上这两个点间的距离。

首先考虑树上的DP，用f[i]表示以i为起点的最长路，g[i]表示以i为根的子树里的最长路，f[i]很容易从儿子转移，g[i]除了儿子的最优解外，还要与f[i] + 以i为起点的次长路比较。

再考虑环上的DP，尝试破环为链把环复制两遍，设一个点在新链里的位置为i，则以i为在环上选的第二个点的最优解就可以从[i - 环大小 + 1, i - 1]这个区间转移过来，这个明显就可以用单调队列来优化了。

时间复杂度O(N)。
