BZOJ 2956 模积和

![](/2956.jpg)

首先利用定义对题目所求进行化简，注意到i和j不相等。在下文中使用div表示整除。我们发现，问题的瓶颈在于求sigma{N div i * i}(1 <= i <= K)。

考虑N div i的取值，当i <= sqrt(N)时，最多只会有sqrt(N)个答案；当i > sqrt(N)时，N div i必然小于sqrt(N)，所以最多只会有sqrt(N)个答案，故可能的答案数不超过2sqrt(N)。

由此，我们枚举i，可以轻易算出当前答案p = N div i和答案p能持续到的位置q = N div p，通过等差数列求和公式计算出在i到q之间位置的和，然后i跳至q + 1继续计算，从而在O(sqrt(N))的时间复杂度内求得答案。

还有一个问题，是求sigma{(N div i) * (M div i) * i^2}(1 <= i <= K)。类似地，N div i与M div i的答案均不超过2sqrt(N)个，而(N div i) * (M div i)的值只会在其中一个发生改变时改变，故其答案不超过4sqrt(N)个，再利用平方和公式，同样能在O(sqrt(N))的时间复杂度内求的答案。

其中，平方和公式里涉及到除以6取模的问题，由于答案必然是整数，我们可以从n, n + 1, 2n + 1三个式中先除掉因子2和3，再进行乘法和取模。

需要注意的是，题中取模较多，且要注意保证每一步乘法都不会爆long long。整体时间复杂度O(sqrt(N))。
