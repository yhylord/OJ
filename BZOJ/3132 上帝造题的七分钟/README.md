BZOJ 3132 上帝造题的七分钟

首先考虑一维的情况，即我们要对一个区间加上某个值，还要查询某个区间的和。

显然，修改和查询的区间[x, y]都可以转化为[1, x - 1]和[1, y]。

那么，我们把修改[1, x']简记为x'，加的数为d，询问[1, x]简记为x。

我们维护两个树状数组，分别处理以下两种情况。

当x' <= x时，x'对x的贡献值为x' * d，因此用树状数组维护所有x的sigma{x' * d}。

当x' > x时，x'对x的贡献值为x * d，因此用树状数组维护所有x的sigma{d}。

维护的时候，自行计算一下影响的范围就可以了。

扩展到二维，其实是一样的。

利用容斥原理，修改和查询的矩阵都可以转化为4个左上角为(1, 1)，右下角为(x, y)的矩阵。

那么，我们把修改简记为(x', y')，加的数为d，询问简记为(x, y)。

我们维护四个树状数组，分别处理以下四种情况。

当x' <= x, y' <= y时，(x', y')对(x, y)的贡献值为x' * y' * d，因此用树状数组维护所有(x, y)的sigma{x' * y' * d}。

当x' <= x, y' > y时，(x', y')对(x, y)的贡献值为x' * y * d，因此用树状数组维护所有(x, y)的sigma{x' * d}。

当x' > x, y' <= y时，(x', y')对(x, y)的贡献值为x * y' * d，因此用树状数组维护所有(x, y)的sigma{y' * d}。

当x' > x, y' > y时，(x', y')对(x, y)的贡献值为x * y * d，因此用树状数组维护所有(x, y)的sigma{d}。

维护的时候，同样自行计算一下影响的范围就可以了。
